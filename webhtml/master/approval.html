<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>审批</title>
<link href="../../css/bootstrap.min.css" rel="stylesheet">
<link href="../../font-awesome/css/font-awesome.css" rel="stylesheet">
<link href="../../css/animate.css" rel="stylesheet">
<link href="../../css/style.css" rel="stylesheet">
<link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">
<!-- Mainly scripts -->
<script src="../../js/jquery-3.1.1.min.js"></script>
<script src="../../js/popper.min.js"></script>
<script src="../../js/bootstrap.js"></script>
<script src="../../js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="../../js/plugins/iCheck/icheck.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="../../js/inspinia.js"></script>
<script src="../../js/plugins/pace/pace.min.js"></script>
 <script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- jQuery UI -->
<script src="../../js/plugins/jquery-ui/jquery-ui.min.js"></script>

<!-- EayPIE -->
<script src="../../js/plugins/easypiechart/jquery.easypiechart.js"></script>

<!-- Sparkline -->
<script src="../../js/plugins/sparkline/jquery.sparkline.min.js"></script>

<!-- Sparkline demo data  -->
<script src="../../js/demo/sparkline-demo.js"></script>
</head>

<body>
<div id="wrapper" class="gray-bg">
  <div id="page-wrapper" class="gray-bg" style="margin: 0;">
    <div class="wrapper wrapper-content"  id="app2">
      <div class="row"> 
        <!--         <div class="col-lg-3">
                  <div class="ibox ">
                    <div class="ibox-content mailbox-content">
                      <div class="file-manager"> <a class="btn btn-block btn-primary compose-mail" href="../manager/mail_compose.html">Compose</a>
                        <div class="space-25"></div>
                        <h5>Folders</h5>
                        <ul class="folder-list m-b-md" style="padding: 0">
                          <li><a href="../manager/mailbox.html"> <i class="fa fa-inbox "></i> Inbox <span class="label label-warning float-right">16</span> </a></li>
                          <li><a href="../manager/mailbox.html"> <i class="fa fa-envelope-o"></i> Send Mail</a></li>
                          <li><a href="../manager/mailbox.html"> <i class="fa fa-certificate"></i> Important</a></li>
                          <li><a href="../manager/mailbox.html"> <i class="fa fa-file-text-o"></i> Drafts <span class="label label-danger float-right">2</span></a></li>
                          <li><a href="../manager/mailbox.html"> <i class="fa fa-trash-o"></i> Trash</a></li>
                        </ul>
                        <h5>Categories</h5>
                        <ul class="category-list" style="padding: 0">
                          <li><a href="#"> <i class="fa fa-circle text-navy"></i> Work </a></li>
                          <li><a href="#"> <i class="fa fa-circle text-danger"></i> Documents</a></li>
                          <li><a href="#"> <i class="fa fa-circle text-primary"></i> Social</a></li>
                          <li><a href="#"> <i class="fa fa-circle text-info"></i> Advertising</a></li>
                          <li><a href="#"> <i class="fa fa-circle text-warning"></i> Clients</a></li>
                        </ul>
                        <h5 class="tag-title">Labels</h5>
                        <ul class="tag-list" style="padding: 0">
                          <li><a href=""><i class="fa fa-tag"></i> Family</a></li>
                          <li><a href=""><i class="fa fa-tag"></i> Work</a></li>
                          <li><a href=""><i class="fa fa-tag"></i> Home</a></li>
                          <li><a href=""><i class="fa fa-tag"></i> Children</a></li>
                          <li><a href=""><i class="fa fa-tag"></i> Holidays</a></li>
                          <li><a href=""><i class="fa fa-tag"></i> Music</a></li>
                          <li><a href=""><i class="fa fa-tag"></i> Photography</a></li>
                          <li><a href=""><i class="fa fa-tag"></i> Film</a></li>
                        </ul>
                        <div class="clearfix"></div>
                      </div>
                    </div>
                  </div>
                </div> -->
        <div class="col-lg-12">
          <div class="mail-box-header">
            <h2> 部门员工请假申请 </h2>
            <div class="mail-tools tooltip-demo m-t-md">
              <button class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="left" title="Refresh inbox"><i class="fa fa-refresh"></i> 刷新 </button>
              <button class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="top" title="agree"  v-on:click="approvalApp"><i class="fa fa-exclamation"></i> 同意 </button>
              <button class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="top" title="disagree"><i class="fa fa-trash-o"></i> 驳回 </button>
            </div>
          </div>
          <div class="mail-box">
            <table class="table table-hover table-mail">
              <tbody>
                <tr class="title">
                  <td class="check-mail"></td>
                  <td class="mail-ontact">员工姓名</td>
                  <td class="mail-ontact">员工编号</td>
                  <td class="mail-ontact">开始时间</td>
                  <td class="mail-ontact">结束时间</td>
                </tr> 
                <tr class="read" v-for="(leaveApp,index) in leaveApps">
                  <td class="check-mail"><input type="checkbox" class="i-checks" :id='"drop-remove_"+index'></td>
                  <td class="mail-ontact"><a href="../manager/mail_detail.html">{{leaveApp.applicatdPersonName}}</a></td>
                  <td class="mail-ontact"><a href="../manager/mail_detail.html">{{leaveApp.applicatdPerson}}</a></td>
                  <td class="mail-ontact"><a href="../manager/mail_detail.html">{{leaveApp.startTime}}</a></td>
                  <td class="mail-ontact"><a href="../manager/mail_detail.html">{{leaveApp.endTime}}</a></td>
                </tr>
				  
				  
              </tbody>
            </table>
          </div>
        </div>
       
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){
            $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green'
            });
})
  new Vue({
    el:"#app2",
    data:{
      selected:[],
	  leaveApps:[],
	  ajaxFlag:0,
		person:[]
    },
    methods:{
		///page init
		pageInit:function(){
			 $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green'
            });
		},
		///根据employeeId获取员工名
		getEmployeeById:function(employeeId){
			console.log("getEmployeeById begin ")
			var that = this
				jQuery.ajax({
					   type:"GET",
					   url:"http://39.105.38.34:8080/api/v1/employees/"+employeeId,
					   contentType:"application/json",
					   xhrFields: {
						 withCredentials: true
					   },
					async:false,
					   crossDomain: true,
					   success:function(data){
						 that.person = JSON.parse(data)[0];
					   },
					   error:function(data){
						 console.log("fail");
					   }
         			});
		},
		///获取某部门所有待批准的请假申请(接口地址待修改)
		getLeaveAppByDepId:function(departmentId){
			var that=this;
			jQuery.ajax({
					   type:"GET",
					   url:"http://39.105.38.34:8080/api/v1/leaves/uncheck/sectors/"+departmentId,
					   contentType:"application/json",
					   xhrFields: {
						 withCredentials: true
					   },
					   crossDomain: true,
						async:false,
					   success:function(data){
						 that.ajaxFlag = 1;
						 that.leaveApps = JSON.parse(data);
					   },
					   error:function(data){
						 console.log("fail");
					   }
         			});
		},
		///管理员批准某申请
		approvalApp:function(){
			var that=this;
			for(var i=0;i<this.leaveApps.length;i++){
				if ($('#drop-remove_'+i).is(':checked')){
					//console.log(i+" is cheaked")
					jQuery.ajax({
					   type:"GET",
					   url:"http://39.105.38.34:8080/api/v1/leaves/ratify/"+that.leaveApps[i].leaveId,
					   contentType:"application/json",
					   xhrFields: {
						 withCredentials: true
					   },
					   crossDomain: true,
						async:false,
					   success:function(data){
						 that.ajaxFlag = 1;
						 that.leaveApps = JSON.parse(data);
					   },
					   error:function(data){
						 console.log("fail");
					   }
         			});
				}
			}
			
			
		},
		///管理员拒绝某申请 
		disApprovalApp:function(applicatedId){}
    },
    created:function(){
		console.log("page begin ")
		//this.pageInit();
		this.getLeaveAppByDepId(123);///这个地方的值是静态的
		//this.getEmployeeById(1)
			for(var i=0;i<this.leaveApps.length;i++){
				console.log("for"+i)
				this.getEmployeeById(this.leaveApps[i].applicatdPerson)
				this.leaveApps[i]["applicatdPersonName"] = this.person.name
				}
			console.dir(this.leaveApps)
		

		////////老王的代码
      //var sectorId=localStorage.getItem("sectorId");
//      jQuery.ajax({
//        type:"GET",
//        url:"http://39.105.38.34:8080/api/v1/EWs/uncheck/sectors/123",
//        contentType:"application/json",
//        xhrFields: {
//          withCredentials: true
//        },
//        crossDomain: true,
//        success:function(data) {
//          that.EWs = JSON.parse(data);
//          that.num = that.EWs.length;
//          //根据employeeId获取员工名
//          for (i = 0; i < that.num; i++) {
//            jQuery.ajax({
//              type: "GET",
//              url: "http://39.105.38.34:8080/api/v1/employees/" + that.EWs[i].applicatedPerson,
//              contentType: "application/json",
//              xhrFields: {
//                withCredentials: true
//              },
//              crossDomain: true,
//              async: false,
//              success: function (result) {
//                var tname = JSON.parse(result);
//                that.EWs[i]['state']=tname[0].name;
//                console.log(i);
//
//              },
//              error: function (result) {
//                console.log("fail");
//              }
//            });
//          }
//        },
//        error:function(data){
//          console.log("fail");
//        }
//      });
      //根据employeeId获取员工名
      // for(var i=0;i<num;i++){
 
    }

  })

</script>
</body>
</html>
