<!doctype html>
<html>
    <head>
    <meta charset="utf-8">
    <title>新建请假记录</title>
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="../../css/animate.css" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/plugins/summernote/summernote-bs4.css" rel="stylesheet">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- import Vue before Element -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <!-- import JavaScript -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- Mainly scripts -->
    <script src="../../js/jquery-3.1.1.min.js"></script>
    <script src="../../js/popper.min.js"></script>
    <script src="../../js/bootstrap.js"></script>
    <script src="../../js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="../../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <script src="../../js/plugins/summernote/summernote-bs4.js"></script>
    <!-- Flot -->
    <script src="../../js/plugins/flot/jquery.flot.js"></script>
    <script src="../../js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="../../js/plugins/flot/jquery.flot.spline.js"></script>
    <script src="../../js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="../../js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="../../js/plugins/flot/jquery.flot.symbol.js"></script>
    <script src="../../js/plugins/flot/jquery.flot.time.js"></script>

    <!-- Peity -->
    <script src="../../js/plugins/peity/jquery.peity.min.js"></script>
    <script src="../../js/demo/peity-demo.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="../../js/inspinia.js"></script>
    <script src="../../js/plugins/pace/pace.min.js"></script>

    <!-- jQuery UI -->
    <script src="../../js/plugins/jquery-ui/jquery-ui.min.js"></script>

    <!-- EayPIE -->
    <script src="../../js/plugins/easypiechart/jquery.easypiechart.js"></script>

    <!-- Sparkline -->
    <script src="../../js/plugins/sparkline/jquery.sparkline.min.js"></script>

    <!-- Sparkline demo data  -->
    <script src="../../js/demo/sparkline-demo.js"></script>
    <script>
        $(document).ready(function(){

            $('.summernote').summernote();

       });
    </script>
    </head>

    <body>
    <div id="wrapper" class="gray-bg">
      <div id="page-wrapper" class="gray-bg" style="margin: 0;">
        <div class="wrapper wrapper-content animated fadeInRight" id="app">
          <div class="row" >
            <div class="col-lg-12">
              <div class="ibox ">
                <div class="ibox-title">
                  <h5>请假申请表 <small>请在此处填报申请请假</small></h5>
                  <div class="ibox-tools"> <a class="col7lapse-link"> <i class="fa fa-chevron-up"></i> </a> <a class="dropdown-toggle" data-toggle="dropdown" href="#"> <i class="fa fa-wrench"></i> </a>
                    <ul class="dropdown-menu dropdown-user">
                      <li><a href="#" class="dropdown-item">Config option 1</a> </li>
                      <li><a href="#" class="dropdown-item">Config option 2</a> </li>
                    </ul>
                    <a class="close-link"> <i class="fa fa-times"></i> </a> </div>
                </div>
                <div class="ibox-content">
                  <div class="row">
                    <div class="col-sm-6 b-r">
                      <h3 class="m-t-none m-b">请假申请</h3>
                      <p>Sign in today for more expirience.</p>
                      <form role="form">
                        <div class="form-group">
                          <label>请假类型</label>
                          <select class="form-control m-b" name="account" id="leaveTypeSelc">
                  <option>病假</option>
				  <option>事假</option>
                </select>
                        </div>
                        <div class="form-group" >
                          <label>Data</label>
                          <div >
                            <div >
                              <el-date-picker 
	  style="width:68%"		  
      v-model="value1"
      type="daterange"
      align="right"
      unlink-panels
      range-separator="至"
      start-placeholder="开始日期"
      end-placeholder="结束日期"
	  value-format="yyyy-MM-dd HH:mm:ss"
      :picker-options="pickerOptions"> </el-date-picker>
                            </div>
                          </div>
                        </div>
                 
                      </form>
                    </div>
                    <div class="col-sm-6">
                      <div class="row">
                        <div class="ibox-content no-padding">
                          <h3 class="m-t-none m-b">请假说明</h3>
                          <div class="summernote" id="summernoteContent">
                            <h3>尊敬的领导</h3>
                            <br/>
                            <ul>
                              <li>生病</li>
                              <li>Make a type specimen book</li>
                              <li>Unknown printer</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
				 <div style="margin-top: 20px">
                          <button class="btn btn-sm btn-primary float-right m-t-n-xs" v-on:click="newLeaveApp"> 提交申请 </button>
                          <label>
                            <input type="checkbox" class="i-checks">
                            Remember me </label>
                        </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            
            <div class="col-lg-12">
              <div class="ibox ">
                <div class="ibox-title">
                  <h5>待销假列表</h5>
                  <div class="ibox-tools"> <a class="collapse-link"> <i class="fa fa-chevron-up"></i> </a> <a class="dropdown-toggle" data-toggle="dropdown" href="#"> <i class="fa fa-wrench"></i> </a>
                    <ul class="dropdown-menu dropdown-user">
                      <li><a href="#" class="dropdown-item">Config option 1</a> </li>
                      <li><a href="#" class="dropdown-item">Config option 2</a> </li>
                    </ul>
                    <a class="close-link"> <i class="fa fa-times"></i> </a> </div>
                </div>
                <div class="ibox-content">
                  <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover dataTables-example" >
                      <thead>
                        <tr>
                          <th>请假类型</th>
                          <th>开始时间</th>
                          <th>结束时间</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="gradeX"  v-for="(leaveAppHistory,index) in leaveAppsHistory"  v-if="leaveAppHistory.reportBack == false  &&  leaveAppHistory.state == 1">
                          <td>{{leaveAppHistory.leaveType}}</td>
                          <td>{{leaveAppHistory.startTime}}</td>
                          <td>{{leaveAppHistory.endTime}}</td>
                          <td class="center"><div class="text-center"> <a data-toggle="modal" class="btn btn-primary" :id=' "xiaojiaBtn_"+leaveAppHistory.leaveId'  v-on:click="newBackApp(leaveAppHistory.leaveId)">销假</a></td>
                        </tr>
                        
                       
                      </tbody>
                     
                    </table>
                  </div>
                  
                  <div id="modal-form" class="modal fade" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-body">
                          <div class="row">
                            <div class="col-sm-6 b-r">
                              <h3 class="m-t-none m-b">Sign in</h3>
                              <p>Sign in today for more expirience.</p>
                              <form role="form">
                                <div class="form-group">
                                  <label>Email</label>
                                  <input type="email" placeholder="Enter email" class="form-control">
                                </div>
                                <div class="form-group">
                                  <label>Password</label>
                                  <input type="password" placeholder="Password" class="form-control">
                                </div>
                                <div>
                                  <button class="btn btn-sm btn-primary float-right m-t-n-xs" type="submit"><strong>Log in</strong></button>
                                  <label>
                                    <input type="checkbox" class="i-checks">
                                    Remember me </label>
                                </div>
                              </form>
                            </div>
                            <div class="col-sm-6">
                              <h4>Not a member?</h4>
                              <p>You can create an account:</p>
                              <p class="text-center"> <a href=""><i class="fa fa-sign-in big-icon"></i></a> </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="ibox ">
                <div class="ibox-title">
                  <h5>请假/销假历史记录 <small>With custom checbox and radion elements.</small></h5>
                  <div class="ibox-tools"> <a class="collapse-link"> <i class="fa fa-chevron-up"></i> </a> <a class="dropdown-toggle" data-toggle="dropdown" href="#"> <i class="fa fa-wrench"></i> </a>
                    <ul class="dropdown-menu dropdown-user">
                      <li><a href="#" class="dropdown-item">Config option 1</a> </li>
                      <li><a href="#" class="dropdown-item">Config option 2</a> </li>
                    </ul>
                    <a class="close-link"> <i class="fa fa-times"></i> </a> </div>
                </div>
                <div class="ibox-content">
                  <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover dataTables-example" >
                      <thead>
                        <tr>
                          <th>编号</th>
                          <th>请假类型</th>
                          <th>请假原因</th>
                          <th>开始时间n</th>
                          <th>结束时间</th>
						<th>申请状态</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="gradeX" v-for="(leaveAppHistory,index) in leaveAppsHistory">
                          <td>{{index}}</td>
                          <td>{{leaveAppHistory.leaveType}}</td>
                          <td>{{leaveAppHistory.leaveReason}}</td>
                          <td class="center">{{leaveAppHistory.startTime}}</td>
                          <td class="center">{{leaveAppHistory.endTime}}</td>
							<td class="center" v-if="leaveAppHistory.state==1">批准</td>
							<td class="center" v-if="leaveAppHistory.state==0">待批</td>
							<td class="center" v-if="leaveAppHistory.state==2">驳回</td>
                        </tr>
                      </tbody>
                     
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</body>
    <script type="text/JavaScript">
    new Vue({
      el: '#app',
      data:{
      pickerOptions: {
          shortcuts: [{
            text: '最近一周',
            onClick(picker) {
              const end = new Date();
              const start = new Date();
              start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
              picker.$emit('pick', [start, end]);
            }
          }, {
            text: '最近一个月',
            onClick(picker) {
              const end = new Date();
              const start = new Date();
              start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
              picker.$emit('pick', [start, end]);
            }
          }, {
            text: '最近三个月',
            onClick(picker) {
              const end = new Date();
              const start = new Date();
              start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
              picker.$emit('pick', [start, end]);
            }
          }]
        },
        value1: '',
		  userInfo:[],
		  applicatdPerson:0,
		  leaveAppsHistory:[]
      },
	methods:{
		///新建一个请假申请
		newLeaveApp:function(){
			var jsono={};		
			jsono["startTime"]=this.value1[0];
			jsono["endTime"]=this.value1[1];
			jsono["applicatdPerson"]=this.applicatdPerson;
			jsono["leaveReason"]="jQuery('#summernoteContent').html()";
			jsono["leaveType"]=(jQuery('#leaveTypeSelc').val()=="病假"?1:2);
			jQuery.ajax({
            type:"POST",
            url:"http://39.105.38.34:8080/api/v1/leaves",
            contentType:"application/json",
            // xhrFields: {
            //     withCredentials: true
            // },
            // crossDomain:true,
			dataType:"json",
			data:JSON.stringify(jsono),
            success:function(data){
				window.location.reload()
                console.log("success");
				alert("申请成功")
			},
            error:function(data){
                console.log("fail");
				alert("网络原因，申请失败")
            }
        });
		},
		///新建一个销假申请
		newBackApp:function(leaveId){
			jQuery.ajax({
            type:"GET",
            url:"http://39.105.38.34:8080/api/v1/leaves/cancel/"+leaveId,
            contentType:"application/json",
            // xhrFields: {
            //     withCredentials: true
            // },
            // crossDomain:true,
            success:function(data){
                console.log("success");
				alert("申请成功")
				window.location.reload()
			},
            error:function(data){
                console.log("fail");
				alert("网络原因，申请失败")
            }
        });
			
		},
		///查询一个员工的请假记录
		getLeaveAppByEmpId:function(employeeId){
			var that = this
			jQuery.ajax({
            type:"GET",
            url:"http://39.105.38.34:8080/api/v1/leaves/employees/"+employeeId,
            contentType:"application/json",
            // xhrFields: {
            //     withCredentials: true
            // },
            // crossDomain:true,
            success:function(data){
				that.leaveAppsHistory= JSON.parse(data)
                console.log("success");
				console.dir(that.leaveAppsHistory)
			},
            error:function(data){
                console.log("fail");
            }
        });
		}
		
	},
		created:function(){
				if(sessionStorage.getItem('userInfo')== null)
					alert("请先登录啊")
				else {
					this.userInfo = JSON.parse(sessionStorage.userInfo);
					this.applicatdPerson = this.userInfo.employeeId
					this.getLeaveAppByEmpId(this.userInfo.employeeId)
				}	
		}
    })
  </script>
</html>
